<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>wod.wiki Cast Receiver</title>
  <!-- Include ChromeCast receiver framework -->
  <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
  
  <!-- Include pre-bundled styles instead of importing from Storybook -->
  <style>
    /* Tailwind-inspired minimal styling */
    :root {
      --color-gray-900: #1a202c;
      --color-gray-800: #2d3748;
      --color-gray-700: #4a5568;
      --color-gray-400: #a0aec0;
      --color-gray-300: #cbd5e0;
      --color-gray-200: #edf2f7;
      --color-blue-600: #3182ce;
      --color-blue-800: #2c5282;
    }
    
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: var(--color-gray-900);
      color: white;
    }
    
    #root {
      height: 100%;
      padding: 1rem;
    }
    
    .header {
      margin-bottom: 1.5rem;
    }
    
    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem 0;
    }
    
    .header p {
      color: var(--color-gray-400);
      margin: 0;
    }
    
    .events-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .event-empty {
      color: var(--color-gray-400);
      padding: 1rem;
      background-color: var(--color-gray-800);
      border-radius: 0.25rem;
      text-align: center;
    }
    
    .event-item {
      padding: 0.75rem;
      background-color: var(--color-gray-800);
      border-radius: 0.25rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
    }
    
    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .event-type {
      font-weight: 500;
      padding: 0.25rem 0.5rem;
      background-color: var(--color-blue-800);
      border-radius: 0.25rem;
      font-size: 0.875rem;
    }
    
    .event-time {
      color: var(--color-gray-400);
      font-size: 0.875rem;
    }
    
    .event-payload {
      background-color: rgba(0, 0, 0, 0.2);
      padding: 0.5rem;
      border-radius: 0.25rem;
      overflow-x: auto;
      font-family: monospace;
      font-size: 0.875rem;
      color: var(--color-gray-300);
      margin-top: 0.25rem;
      white-space: pre;
    }
    
    .controls {
      margin-top: 1.5rem;
      border-top: 1px solid var(--color-gray-800);
      padding-top: 1rem;
    }
    
    button {
      padding: 0.5rem 1rem;
      background-color: var(--color-blue-600);
      color: white;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      font-size: 0.875rem;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background-color: var(--color-blue-800);
    }
  </style>
</head>
<body>
  <div id="root">
    <header class="header">
      <h1>wod.wiki Cast Receiver</h1>
      <p>Displaying workout events from sender devices</p>
    </header>
    
    <div id="events-list" class="events-list">
      <div class="event-empty">Waiting for events...</div>
    </div>
    
    <div class="controls">
      <button id="test-event-btn">Add Test Event</button>
    </div>
  </div>
  
  <script>
    // Simple standalone script for the Cast Receiver
    (function() {
      // Event data structure
      class Event {
        constructor(type, payload) {
          this.id = crypto.randomUUID();
          this.type = type;
          this.timestamp = Date.now();
          this.payload = payload;
        }
      }
      
      // Store events
      const events = [];
      const eventsList = document.getElementById('events-list');
      const testEventBtn = document.getElementById('test-event-btn');
      
      // Initialize with a sample event
      addEvent(new Event('INITIALIZATION', { message: 'ChromeCast receiver initialized' }));
      
      // Add event to the list and update UI
      function addEvent(event) {
        events.push(event);
        updateEventsList();
      }
      
      // Update the events list UI
      function updateEventsList() {
        if (events.length === 0) {
          eventsList.innerHTML = '<div class="event-empty">Waiting for events...</div>';
          return;
        }
        
        eventsList.innerHTML = '';
        events.forEach(event => {
          const eventEl = document.createElement('div');
          eventEl.className = 'event-item';
          
          const eventHeader = document.createElement('div');
          eventHeader.className = 'event-header';
          
          const eventType = document.createElement('span');
          eventType.className = 'event-type';
          eventType.textContent = event.type;
          
          const eventTime = document.createElement('span');
          eventTime.className = 'event-time';
          eventTime.textContent = new Date(event.timestamp).toLocaleTimeString();
          
          eventHeader.appendChild(eventType);
          eventHeader.appendChild(eventTime);
          
          const eventPayload = document.createElement('pre');
          eventPayload.className = 'event-payload';
          eventPayload.textContent = JSON.stringify(event.payload, null, 2);
          
          eventEl.appendChild(eventHeader);
          eventEl.appendChild(eventPayload);
          
          eventsList.appendChild(eventEl);
        });
      }
      
      // Add test event button
      testEventBtn.addEventListener('click', () => {
        addEvent(new Event('TEST_EVENT', { 
          message: 'Test event triggered manually',
          timestamp: new Date().toISOString()
        }));
      });
      
      // TODO: Implement actual ChromeCast receiver SDK integration
      console.log('ChromeCast receiver initialized');
      
      // Example of how to listen for cast messages
      if (window.cast && window.cast.framework) {
        const castContext = cast.framework.CastReceiverContext.getInstance();
        const options = new cast.framework.CastReceiverOptions();
        
        // Configure custom channels
        options.customNamespaces = {
          'urn:x-cast:com.wod.wiki': cast.framework.system.MessageType.JSON
        };
        
        castContext.addCustomMessageListener('urn:x-cast:com.wod.wiki', event => {
          console.log('Received cast message:', event);
          if (event.data) {
            addEvent(new Event('CAST_MESSAGE', event.data));
          }
        });
        
        castContext.start(options);
      }
    })();
  </script>
</body>
</html>
