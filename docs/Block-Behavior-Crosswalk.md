

---
Runtime.Next()
- CodeStatments[] -> Jit -> BlockContext + BlockBehaviors 
-  BlockContext + BlockBehaviors  -> RuntimeBlock -> push Stack


BlockContext - a collection Ref[] that are handed off to the block to 

RuntimeBlock ==  

All right let's think about this in terms of a very large update The goal here is to reason about where the composition of behaviors belongs the runtime block it's really just a vessel whose behavior is composed of different collection of these I runtime behavior objects which need to have shared access to the different pieces of memory that need to be created depending on the type of statement or statements the compiler is currently working through.   This means that the responsibility of deciding which behaviors include part of runtime block are part of the runtime strategy that the JIT compiler is using to figure out what to do with the statement blocks that are being passed to it. This also means that the memory allocation for the behaviors and for all of the runtime block also belongs to the strategies that decide how to assemble that runtime block.

The outcome of this is that the runtime block is a generic single implementation type,  The collection of references that the block is using is part of the block context and both the block and the block context should be handled tracked on the stack as a tuple so that the memory can be released correctly when the block after the block is poped.


Here are the different behaviors that i see being needed between the different configurations.. 

---

## Behavior Comparison Matrix

This table provides a detailed comparison of each available `IRuntimeBehavior`, outlining its function at each lifecycle stage.

| Behavior              | `onPush`                                                                                                                                                                                                                               | `onNext`                                                                                                                                                      | `onPop`                                                                 | Notes                                                                                                                |
| --------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------- |
| **`OnPushStart`**     | Sets the start action on the timer TimeSpan reference.                                                                                                                                                                                 | -                                                                                                                                                             | -                                                                       | Manages the sequential execution of child blocks. Provides state for other behaviors like `LazyCompilationBehavior`. |
| **`OnPushNext`**      | Automatically triggers the onNext  on this Block                                                                                                                                                                                       | -                                                                                                                                                             | -                                                                       | Manages the sequential execution of child blocks. Provides state for other behaviors like `LazyCompilationBehavior`. |
| **`OnNextIncrement`** | -                                                                                                                                                                                                                                      | Update the Index references for                                                                                                                               | -                                                                       | Acts as a simple flag to signal when a block with children has finished executing all of them.                       |
| **`MetricsWriter`**   | - Writes the current metrics to the Memory allowing access to this in the runtime.                                                                                                                                                     | - Existing metrics are logged against  the current collection of timers<br>- Writes the current metrics to the Memory allowing access to this in the runtime. | - Existing metrics are logged against  the current collection of timers |                                                                                                                      |
| **`ShareMetrics`**    | - Write the metric visible to children to memory                                                                                                                                                                                       | Write the metric visible to children to memory                                                                                                                |                                                                         |                                                                                                                      |
| **`OnNextPushChild`** | -                                                                                                                                                                                                                                      | Generates an action to Send                                                                                                                                   | -                                                                       | Implements a Just-In-Time (JIT) compilation strategy to improve performance. Can optionally cache compiled blocks.   |
| **`DurationListner`** | Create a memory location that reference the Active timer and the expected durations.                                                                                                                                                   | -                                                                                                                                                             |                                                                         |                                                                                                                      |
| **`EventListner`**    | Create a memory location that can process Events that are triggered on the runtime message pump.  (this could be a base class and may have many versions of it to support different event responses with different memory references.) | -                                                                                                                                                             | -                                                                       |                                                                                                                      |


