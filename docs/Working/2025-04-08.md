## 21:00 - Plan Layout Adjustment for Home.mdx
1.  Wrap the `EditorContainer` and the list `div` in a parent `div`.
2.  Apply `flex flex-col md:flex-row` to the parent `div` to handle stacking on small screens and side-by-side layout on medium+ screens.
3.  Assign `md:w-2/3` to the `EditorContainer`'s wrapper (if needed, or directly if it's a block element) for medium+ screens.
4.  Assign `w-full md:w-1/3 md:pl-4` to the list's `div` to make it full width on small screens, 1/3 width on medium+ screens, and add some padding on the left for medium+ screens.

### Summary

This plan used Tailwind's responsive design utilities to create a two-column layout on medium and larger screens (editor taking 2/3, list taking 1/3) and stacks them vertically on smaller screens.

### Completed Steps

*   [x]: 21:00 - Generate plan for layout adjustment.
*   [x]: 21:00 - Execute the file edit for `Home.mdx`.
*   [x]: 21:00 - Log execution details.

### Next Steps

*   [ ]: 21:00 - No further steps planned for this task.

### Execution Summary
Applied Tailwind CSS classes to `src/stories/Home.mdx` to create a responsive layout. The `EditorContainer` now takes 2/3 width and the syntax guide takes 1/3 width on medium screens and above, stacking vertically on smaller screens. The changes were applied successfully.

## 21:03 - Plan Always Stack Layout for Home.mdx
1.  Modify the parent `div` containing the editor and help text: remove `md:flex-row` class, leaving only `flex-col`.
2.  Modify the help text `div`: remove `md:w-1/3` and `md:pl-4`. Ensure it has `w-full`. Move this div *before* the editor's div in the source order.
3.  Modify the editor's wrapper `div`: remove `md:w-2/3`. Ensure it has `w-full`. Remove `pt-4 md:pt-0` from the help text div if added previously, and ensure the editor div has appropriate top padding if needed (e.g., `pt-4`).

### Summary

This plan rearranges the elements in the code and updates the Tailwind CSS classes to ensure the syntax guide is always displayed above the editor in a single column layout, regardless of the screen width.

### Completed Steps

*   [x]: 21:03 - Generate plan for always-stacked layout.
*   [x]: 21:03 - Execute the file edit for `Home.mdx`.
*   [x]: 21:03 - Log execution details.

### Next Steps

*   [ ]: 21:03 - No further steps planned for this task.

### Execution Summary
Reordered elements and updated Tailwind classes in `src/stories/Home.mdx` so the Syntax Guide is always displayed above the editor, stacked vertically. Removed responsive classes (`md:flex-row`, `md:w-2/3`, `md:w-1/3`, `md:pl-4`) and adjusted padding. The changes were applied successfully.

## 21:13 - Plan Enable Inline Editing in EventsView

1.  Create Editable Cell Component
2.  Integrate into `EventsView`
3.  Implement State Update *Callback* in `EventsView` (`handleSaveMetric` calls `onUpdateResult`)
4.  Refine Validation Handling in `EditableMetricCell` (prevent blur/save on fail, error style)
5.  Implement Input Parsing for Resistance/Distance in `handleSaveMetric`
6.  Disable Editing for 'Reps' column in `EventsView`
7.  Connect `EventsView` to Parent State Management (implement `onUpdateResult` logic in parent)
8.  (Optional) Enhance validation styling/feedback.

### Summary
Introduced inline editing for resistance/distance in `EventsView`. Created `EditableMetricCell` for input handling, validation feedback (error state, keeps input open on fail), and saving/canceling. `EventsView` now parses input, calls an `onUpdateResult` prop with the modified data, accepts a `validateMetric` prop, and disables editing for the aggregate 'Reps' column. The next step is to implement the state update logic in the component that uses `EventsView`.

### Completed Steps

*   [x]: 21:13 - Plan created.
*   [x]: 21:17 - Created `EditableMetricCell.tsx`.
*   [x]: 21:21 - Integrated `EditableMetricCell` into `EventsView.tsx` (placeholder save).
*   [x]: 21:25 - Refined Validation Handling in `EditableMetricCell`.
*   [x]: 21:31 - Added parsing, `onUpdateResult` prop/call, `validateMetric` prop, and disabled Reps edit in `EventsView`.
*   [x]: 21:50 - Connected state update logic from `useTimerRuntime` hook down to `EventsView` via `EditorContainer` and `ResultsDisplay`.

### Next Steps

*   [ ]: 21:50 - (Optional) Pass a specific `validateMetric` function from the parent if needed.
*   [ ]: 21:50 - (Optional) Enhance validation styling/feedback (e.g., tooltips).


## 21:38 - Refactor: Log Metric Edits as Instructions

1.  [x]: Define `ResultMetricUpdate` type in `timer.types.ts`.
2.  [x]: Add `metricUpdates` state and `handleAddMetricUpdate` function (with console logging) to `EditorContainer.tsx`.
3.  [x]: Pass `handleAddMetricUpdate` down through `ResultsDisplay` to `EventsView` as `onAddMetricUpdate`.
4.  [x]: Modify `EventsView.handleSaveMetric` to parse value and call `onAddMetricUpdate` with a `ResultMetricUpdate` object.
5.  [x]: Remove old direct update logic (`updateResultMetrics`, `onUpdateResult`, `onResultsUpdated`) from the hook and components.

### Summary
Refactored the inline metric editing mechanism. Instead of directly modifying the `results` state, edits now generate `ResultMetricUpdate` instructions. These instructions are collected in a `metricUpdates` state array within `EditorContainer.tsx` and the current list is logged to the console upon each update. This decouples editing from the runtime's state management. The UI does not visually reflect these logged updates.

### Completed Steps
*   [x]: 21:38 - Refactor plan created.
*   [x]: 21:39 - Defined `ResultMetricUpdate` type.
*   [x]: 21:41 - Added `metricUpdates` state and `handleAddMetricUpdate` logger to `EditorContainer`.
*   [x]: 21:45 - Passed `handleAddMetricUpdate` down to `EventsView` via `ResultsDisplay`.
*   [x]: 21:48 - Updated `EventsView.handleSaveMetric` to create instruction and call `onAddMetricUpdate`.
*   [x]: 21:52 - Removed old `updateResultMetrics`/`onUpdateResult`/`onResultsUpdated` logic.

### Next Steps
*   [ ]: 21:52 - Decide how/when to apply the logged `metricUpdates` instructions (e.g., push to a backend, merge back into results state later).


## 21:55 - Refactor: Standardize RuntimeMetric.repetitions

1.  [x]: Change `RuntimeMetric.repetitions` type from `number` to `MetricValue`.
2.  [x]: Update metric creation in `DefaultResultLogger` and `WorkRestLogger` to use `{ value: reps, unit: "" }` for repetitions.
3.  [x]: Update metric consumption in `WodTable`, `WodResultsRow`, `WodResults`, and `EventsView` to access `metric.repetitions?.value`.

### Summary
Standardized the `repetitions` field within the `RuntimeMetric` type to use the `MetricValue` structure (`{ value: number, unit: string }`), consistent with `resistance` and `distance`. Updated the logger classes (`DefaultResultLogger`, `WorkRestLogger`) to correctly create this structure with an empty unit string. Updated all relevant display and calculation logic in analytics components to access the `.value` property of `repetitions`.

### Completed Steps
*   [x]: 21:55 - Plan created.
*   [x]: 21:56 - Updated `RuntimeMetric` type definition.
*   [x]: 21:59 - Updated `DefaultResultLogger.createMetrics`.
*   [x]: 22:01 - Updated `WorkRestLogger.createMetrics`.
*   [x]: 22:05 - Updated analytics components (`WodTable`, `WodResultsRow`, `WodResults`, `EventsView`) to consume `repetitions.value`.

### Next Steps
*   [ ]: 22:05 - Continue development or testing.

## 21:50 - Plan Enable Inline Editing in EventsView
1.  Create Editable Cell Component
2.  Integrate into `EventsView`
3.  Implement State Update *Callback* in `EventsView` (`handleSaveMetric` calls `onUpdateResult`)
4.  Refine Validation Handling in `EditableMetricCell` (prevent blur/save on fail, error style)
5.  Implement Input Parsing for Resistance/Distance in `handleSaveMetric`
6.  Disable Editing for 'Reps' column in `EventsView`
7.  Connect `EventsView` to Parent State Management (implement `onUpdateResult` logic in parent)
8.  (Optional) Enhance validation styling/feedback.

### Summary
Introduced inline editing for resistance/distance in `EventsView`. Created `EditableMetricCell` for input handling, validation feedback (error state, keeps input open on fail), and saving/canceling. `EventsView` now parses input, calls an `onUpdateResult` prop with the modified data, accepts a `validateMetric` prop, and disables editing for the aggregate 'Reps' column. The state update logic is connected via the `useTimerRuntime` hook through `EditorContainer` and `ResultsDisplay`.

### Completed Steps

*   [x]: 21:13 - Plan created.
*   [x]: 21:17 - Created `EditableMetricCell.tsx`.
*   [x]: 21:21 - Integrated `EditableMetricCell` into `EventsView.tsx` (placeholder save).
*   [x]: 21:25 - Refined Validation Handling in `EditableMetricCell`.
*   [x]: 21:31 - Added parsing, `onUpdateResult` prop/call, `validateMetric` prop, and disabled Reps edit in `EventsView`.
*   [x]: 21:50 - Connected state update logic from `useTimerRuntime` hook down to `EventsView` via `EditorContainer` and `ResultsDisplay`.

### Next Steps

*   [ ]: 21:50 - (Optional) Pass a specific `validateMetric` function from the parent if needed.
*   [ ]: 21:50 - (Optional) Enhance validation styling/feedback (e.g., tooltips).

### Execution Summary
Introduced inline editing for resistance/distance in `EventsView`. Created `EditableMetricCell` for input handling, validation feedback (error state, keeps input open on fail), and saving/canceling. `EventsView` now parses input, calls an `onUpdateResult` prop with the modified data, accepts a `validateMetric` prop, and disables editing for the aggregate 'Reps' column. The state update logic is connected via the `useTimerRuntime` hook through `EditorContainer` and `ResultsDisplay`.

## 22:08 - Feature: Enable Repetition Editing & Timestamp Edits

1.  [x]: Update `RuntimeMetricEdit` type to include `'repetitions'` and `createdAt: Date`.
2.  [x]: Update `EventsView.handleSaveMetric` to populate `createdAt` and allow `'repetitions'` type.
3.  [x]: Change 'Reps' column in `EventsView` to use `EditableMetricCell` for repetitions.
4.  [x]: Update `EventsView.defaultValidator` to validate non-negative integers for repetitions.

### Summary
Enabled inline editing for the 'Reps' column in the `EventsView` component. Updated the `RuntimeMetricEdit` type to support `'repetitions'` as a `metricType` and added a `createdAt` timestamp field. Modified `EventsView` to use an `EditableMetricCell` for repetitions, create the correct `RuntimeMetricEdit` object (including the timestamp) on save, and validate the input as a non-negative integer.

### Completed Steps
*   [x]: 22:08 - Plan created.
*   [x]: 22:09 - Updated `RuntimeMetricEdit` type.
*   [x]: 22:10 - Updated `EventsView.handleSaveMetric`.
*   [x]: 22:12 - Updated 'Reps' `TableCell` in `EventsView` to use `EditableMetricCell`.
*   [x]: 22:14 - Updated `EventsView.defaultValidator`.

### Next Steps
*   [ ]: 22:14 - Decide how/when to apply the logged `metricUpdates` instructions.

## 22:06 - Refactor: Simplify WodResults & WodResultsRow
1.  [x]: Update `WodResultsRow.ResultMetricItem` interface for direct `MetricValue` properties (`repetitions?`, `resistance?`, `distance?`) and remove generic `value`/`unit`.
2.  [x]: Remove unit-checking logic from `WodResultsRow` and simplify rendering.
3.  [x]: Update `WodResults` metric flattening (`flatMap`) to create the new `ResultMetricItem` structure.
4.  [x]: Remove obsolete `isWeightUnit`/`isDistanceUnit` helpers from `WodResults`.
5.  [x]: Update aggregate calculations (`totalWeight`/`totalDistance`) and unit finding in `WodResults` to use the new structure.

### Summary
Refactored `WodResultsRow` and `WodResults` components. Updated the `ResultMetricItem` interface used by `WodResultsRow` to directly include optional `MetricValue` properties for `repetitions`, `resistance`, and `distance`, removing generic `value` and `unit`. Simplified `WodResultsRow` by removing redundant logic that inferred metric types from units. Updated `WodResults` to create `ResultMetricItem` objects matching the new interface and adjusted aggregate calculations (`totalWeight`, `totalDistance`) and unit finding (`weightUnit`, `distanceUnit`) accordingly, removing obsolete helper functions.

### Completed Steps
*   [x]: 22:06 - Plan created.
*   [x]: 22:07 - Updated `WodResultsRow.tsx`.
*   [x]: 22:09 - Updated `WodResults.tsx`.

### Next Steps
*   [ ]: 22:09 - Continue development or testing.
