# Feature: Repair System Button Events

## Purpose
Document and repair the system-level event handling for button actions (run, pause, stop, reset) in wod.wiki. Identify where logic is crosswired between the two main event pipelines and propose a robust, SOLID-compliant structure.

## Background
Currently, button events are handled in two places, both following a similar pipeline. This has led to crosswiring and bugs affecting run/pause/stop/reset behaviors.

## Initial Steps
1. Document the two locations handling button events.
2. Map the event pipeline for each button action in both locations.
3. Diagram the flow to visualize logic overlaps or duplications.
4. Summarize findings and highlight areas of concern.

## Findings & Areas of Concern

### Summary of Findings
- Two main locations for button event logic:
  1. **UI Layer** (RunnerControls and related components): Determines visible buttons and dispatches events to the runtime.
  2. **Runtime Layer** (handlers like StartHandler, StopHandler, ResetHandler): Processes events, updates state, and issues actions (e.g., SetButtonAction) to update the UI.

### Key Areas of Concern
- **Duplication of Button State Logic:** Both UI and runtime layers contain logic for active/visible buttons, risking inconsistencies if not kept in sync.
- **Event Pipeline Crosswiring:** UI may allow actions the runtime does not accept, or runtime may ignore/discard events, leading to mismatches and bugs.
- **SOLID Violation Risk:** Mixing UI and runtime state logic can violate the Single Responsibility and Interface Segregation Principles.
- **Difficult Debugging:** Bugs in button behavior are hard to trace to the UI, runtime, or their interaction.

## Event Flow Diagram & Logic Overlaps

Below is a corrected mermaid diagram (no special characters, HTML, or brackets) illustrating the current event flow for button actions Run, Pause, Stop, Reset and where logic is duplicated or crosswired between the UI and runtime layers:

![[2025-04-14.repair-system-button-events 2025-04-14 18.36.33.excalidraw]]
### Explanation
- Both the UI and runtime determine which buttons are shown, creating potential for inconsistent states.
- Dashed arrows: Feedback or circular dependency between UI and runtime button logic.

#### Where Logic Overlaps or Duplicates
- The UI layer (RunnerControls) uses its own state to decide which buttons to display.
- The runtime layer, via SetButtonAction, also dictates button visibility.
- If these two sources of truth diverge, the UI and runtime can become unsynchronized, leading to bugs in button behavior.

## References
- Editor and runtime event/action system
- docs/docs/Components/Editor.md
- docs/docs/Components/Runtime.md
- docs/docs/Components/Compile.md

---

## Worklog
- [ ] [[2025-04-14.repair-system-button-events.kb.md#Backlog]] Tasks are tracked in the Kanban board.

---
