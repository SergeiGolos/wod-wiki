Today goal is to update to structure of the application and to inline into better workflow grouped better by function.

## I. Actionable Points & Tasks

### 1. Define `onTick` Event Handling

- **Action:** Add syntax to the language to represent how different events (countdown, timer, user input, lap events) trigger actions within a Runtime Block.
- **Goal:** Enable the language to express event-driven behavior.

### 2. Refactor Interpreter/Compiler Logic

- **Action:** Move the logic for creating Runtime Blocks from what is currently called the "Compiler" into the Visitor. The Visitor should create "State" and "Blocks" that the Runtime can assemble.
- **Goal:** Clarify the responsibilities of the Visitor and Runtime, making the system more modular.

### 3. Design Runtime Block Generation

- **Action:** Determine how the parent Statement Nodes in the tree control the generation of child Runtime Blocks. The parent should likely decide how to handle re-entry and generate subsequent blocks.
- **Goal:** Establish a clear mechanism for traversing the Statement Tree and creating the corresponding Runtime Blocks.

### 4. Implement "Fake Results" Generation

- **Action:** Develop a way to process the Statement Tree with pre-set default values and allow for user-provided token variables (e.g., reps, weight, time).
- **Goal:** Enable testing and simulation before actual data collection. This is crucial for validating the logic and metrics calculations.

### 5. Clarify Statement Block and Metric Calculation Relationship

- **Action:** Investigate whether the Statement Block should directly carry the metric calculation logic, or if the metrics should be handled separately.
- **Goal:** Determine best design. Separating them would likely improve flexibility and extensibility.

### 6. Runtime Block and Stack creation

- **Action:** Runtime needs to generate a list of events with statement blocks.
- **Goal:** Make sure the runtime can take the block information, and apply it in order.

### 7. Define Result block creation

- **Action:** Flesh out how the runtime block will represent the information and result in a list of Result Blocks.
- **Goal:** Define how results are generated, stored, and passed.

## III. Summaries & Key Ideas

### Overall Architecture

The system is designed to parse code, build a Statement Tree, translate that into a series of Runtime Blocks that represent the execution flow, and then use Metrics Calculators to analyze the results.

### Runtime as a State Machine

The Runtime essentially acts as a state machine, stepping through Runtime Blocks and maintaining a stack of execution contexts.

### Extensibility

The design emphasizes extensibility through:

- Stackable Metrics Calculators.
- The ability to support different "versions" of the language for different training methodologies.
- Potentially separating metric calculations from the core language.

### Simulation/Testing

The ability to generate "fake results" is a key requirement for testing and development.

## IV. Open Questions & Considerations

### Precise Syntax for Event Handling

How will `onTick` and other events be represented in the language syntax?

### Relationship between Statement Blocks and Metrics

Should the Statement Block contain the metric calculation, or should it be separate? The notes strongly suggest separation is better.

### "Compiler" vs. "Interpreter"

The terminology is a bit blurred. The system seems to be more of an interpreter than a traditional compiler.

### How are result blocks consumed?

What component of the larger picture uses the result blocks?

## File Structure

```markdown
src/
├── core/                        # Core domain logic
│   └── runtime/                 # Runtime engine
│       ├── actions/             # Runtime actions
│       │   ├── SetDisplayAction.ts
│       │   ├── EventAction.ts   # Base action class
│       │   ├── SetButtonAction.ts
│       │   └── SetResultAction.ts
│       └── compiler-strategies/ # Compiler strategies
│           ├── AMRAPStrategy.ts
│           ├── CompoundStrategy.ts
│           ├── RepeatingGroupStrategy.ts
│           ├── RepeatingStatementStrategy.ts
│           ├── SingleUnitStrategy.ts
│           └── StatementStrategy.ts
├── hooks/                       # React hooks
│   └── useTimerRuntime.ts       # Timer runtime hook
├── lib/                         # Library code
│   ├── editor/                  # Editor components
│   │   ├── ButtonRibbon.tsx     # Button controls
│   │   ├── EditorContainer.tsx  # Main editor container
│   │   ├── ResultsDisplay.tsx   # Display workout results
│   │   ├── SemantcTokenEngine.tsx # Syntax highlighting
│   │   ├── SuggestionEngine.tsx # Code suggestions
│   │   ├── WodResults.tsx       # Workout results component
│   │   ├── WodTable.tsx         # Table display
│   │   ├── WodWiki.tsx          # Monaco editor wrapper
│   │   └── WodWikiSyntaxInitializer.tsx # Editor initialization
│   ├── fragments/               # Workout language fragments
│   │   ├── EffortFragment.ts    # Effort intensity
│   │   ├── IncrementFragment.ts # Increment values
│   │   ├── LapFragment.ts       # Lap tracking
│   │   ├── RepFragment.ts       # Repetition counts
│   │   ├── ResistanceFragment.ts # Weight/resistance
│   │   ├── RoundsFragment.ts    # Round counts
│   │   ├── TextFragment.ts      # Text elements
│   │   └── TimerFragment.ts     # Timer elements
│   ├── hooks/                   # React hooks
│   ├── runtimes/                # Runtime handlers
│   │   ├── actions/             # Actions directory
│   │   ├── durations/           # Duration handlers
│   │   │   ├── CountDownDurationHandler.ts
│   │   │   ├── StopwatchDurationHandler.ts
│   │   │   └── TotalDurationHandler.ts
│   │   ├── NextChildStatementAction.ts
│   │   ├── RepeatingChildRuntimeHandler.ts
│   │   ├── RepeatingRuntimeHandler.ts
│   │   ├── SkippedRuntimeHandler.ts
│   │   └── StopwatchRuntimeHandler.ts
│   ├── timer/                   # Timer components
│   │   ├── LapTimes.tsx         # Lap time display
│   │   ├── TimerControls.tsx    # Timer controls
│   │   ├── TimerDisplay.tsx     # Timer display
│   │   └── WodTimer.tsx         # Main timer component
│   └── wod-lang/                # Workout language core
│       ├── timer.actions.ts     # Runtime actions
│       ├── timer.parser.ts      # Language parser
│       ├── timer.runtime.ts     # Runtime engine
│       ├── timer.tokens.ts      # Language tokens
│       ├── timer.types.ts       # Type definitions
│       └── timer.visitor.ts     # AST visitor
├── types/                       # TypeScript type definitions
└── utils/                       # Utility functions
    └── supabase/                # Supabase utilities
