{
  "$schema": "https://aka.ms/codetour-schema",
  "title": "Runtime Unit Testing",
  "description": "Learn the three-tier testing strategy: Unit Tests, Integration Tests, and Hook Tests for the runtime project.",
  "steps": [
    {
      "title": "Introduction",
      "description": "# Runtime Unit Testing Tour ðŸ§ª\n\nThis tour will teach you how we test the runtime engine using a **three-tier strategy**:\n\n1.  **Unit Tests**: Isolated behavior testing using mock contexts.\n2.  **Integration Tests**: Multi-behavior compositions using MockClock.\n3.  **Hook Tests**: React hook validation with mock blocks.\n\nAll tests are driven by `bun:test` for maximum performance.",
      "file": "docs/runtime-project/testing-summary.md",
      "line": 8
    },
    {
      "title": "Test Environment Setup",
      "description": "### Environment Setup\n\nOur unit tests require a browser-like environment (JSDOM) and animation polyfills because behaviors often interact with timers and clocks.\n\nAlways run tests with the preload flag:\n\n```bash\nbun test <path> --preload ./tests/unit-setup.ts\n```",
      "file": "tests/unit-setup.ts",
      "line": 6
    },
    {
      "title": "Tier 1: Unit Test Patterns",
      "description": "### The Mock Context Pattern\n\nIndividual behaviors are tested by passing a mock `IBehaviorContext`. This mock tracks interactions like `setMemory`, `emitEvent`, and `markComplete` without running any real runtime logic.",
      "file": "src/runtime/behaviors/__tests__/AspectBehaviors.test.ts",
      "line": 11
    },
    {
      "title": "Testing Behavior Lifecycle",
      "description": "### onMount Lifecycle\n\nTo test a behavior, we arrange the behavior and its configuration, call a lifecycle method like `onMount`, and then assert that the correct side-effects occurred in the context.",
      "file": "src/runtime/behaviors/__tests__/AspectBehaviors.test.ts",
      "line": 33
    },
    {
      "title": "Event Emission Check",
      "description": "### Communicating via Events\n\nBehaviors shouldn't modify other behaviors directly. Instead, they emit events. We verify that behaviors emit the correct event names (like `timer:started`) with the expected data.",
      "file": "src/runtime/behaviors/__tests__/AspectBehaviors.test.ts",
      "line": 48
    },
    {
      "title": "Tier 2: Integration Testing",
      "description": "### Multi-Behavior Composition\n\nIntegration tests live here. They verify that when we combine multiple single-responsibility behaviors (Init, Tick, Completion), the resulting \"block\" works as expected.",
      "file": "src/runtime/behaviors/__tests__/integration/test-helpers.ts",
      "line": 7
    },
    {
      "title": "Controlled Time (MockClock)",
      "description": "### MockClock\n\nWe use a `MockClock` to avoid using real `setTimeout` or waiting in tests. We can manually `.advance()` time and assert that behaviors reacted correctly.",
      "file": "src/runtime/behaviors/__tests__/integration/test-helpers.ts",
      "line": 17
    },
    {
      "title": "The Integration Runtime",
      "description": "### MockRuntime\n\nUnlike unit tests, integration tests use a `MockRuntime` that tracks all events, outputs, and the completion status across the entire simulation.",
      "file": "src/runtime/behaviors/__tests__/integration/test-helpers.ts",
      "line": 42
    },
    {
      "title": "Composition Example",
      "description": "### Building Countdown Timers\n\nHere we see how we build a countdown timer by composing `TimerInit`, `TimerTick`, `TimerCompletion`, and `TimerOutput` behaviors together.",
      "file": "src/runtime/behaviors/__tests__/integration/timer-block.test.ts",
      "line": 42
    },
    {
      "title": "Integration Assertions",
      "description": "### expectMemoryState\n\nWe use specialized helpers like `expectMemoryState` to deep-match the internal state of the block after complex mutations have occurred.",
      "file": "src/runtime/behaviors/__tests__/integration/timer-block.test.ts",
      "line": 51
    },
    {
      "title": "Round-Based Integration",
      "description": "### Round Completion\n\nThis test verifies that after multiple calls to `advanceBehaviors()` (simulating pressing 'Next'), the `RoundCompletionBehavior` correctly marks the block as complete.",
      "file": "src/runtime/behaviors/__tests__/integration/loop-block.test.ts",
      "line": 65
    },
    {
      "title": "Observable Memory",
      "description": "### Memory Subscriptions\n\nOur memory entries are observable. This test verifies that starting a timer notifies all subscribers, which is how React components know when to update.",
      "file": "src/runtime/memory/__tests__/MemoryEntries.test.ts",
      "line": 21
    },
    {
      "title": "Tier 3: Testing Hooks",
      "description": "### Hook Mocking\n\nTo test hooks like `useTimerState`, we use a mock memory entry that allows us to manually trigger updates and observe how the hook reacts.",
      "file": "src/runtime/hooks/__tests__/useBlockMemory.test.ts",
      "line": 50
    },
    {
      "title": "React Integration",
      "description": "### renderHook\n\nUsing `@testing-library/react`, we render hooks in isolation and verify they return the correct derived state (like formatted time strings).",
      "file": "src/runtime/hooks/__tests__/useBlockMemory.test.ts",
      "line": 75
    },
    {
      "title": "The Unified Harness",
      "description": "### BehaviorTestHarness\n\nFor new tests, use the `BehaviorTestHarness`. It provides a real (not mocked) stack and memory while still allowing for easy assertion of actions and events.",
      "file": "src/testing/harness/BehaviorTestHarness.ts",
      "line": 37
    },
    {
      "title": "Harness API",
      "description": "### Fluent Configuration\n\nThe harness uses a chainable API to set up the execution environment, making tests concise and readable.",
      "file": "src/testing/harness/BehaviorTestHarness.ts",
      "line": 127
    },
    {
      "title": "Conclusion",
      "description": "### Ready to test!\n\nYou're now equipped to write comprehensive tests for the runtime. \n\nRemember to check the [Testing Summary](cci:1://file:///docs/runtime-project/testing-summary.md) for more details.\n\nðŸŽ‰ Done!",
      "file": "docs/runtime-project/testing-summary.md",
      "line": 430
    }
  ]
}
