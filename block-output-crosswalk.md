# Block-Output Crosswalk

This document breaks down the different types of blocks generated by the compiler strategies and details what output events each block type reports.

## Overview of Output Behaviors

*   **SegmentOutputBehavior**: Emits `segment` events on *RuntimeBlock Mount* (start) and `completion` events on *RuntimeBlock Unmount* (end). This drives timeline visualization.
*   **TimerOutputBehavior**: Adds timer-specific duration data to the `completion` event on *Unmount*.
*   **RoundOutputBehavior**: Emits `milestone` events on *RuntimeBlock Next* (round advance) with the current round count.
*   **HistoryRecordBehavior**: Emits a `history:record` event on *RuntimeBlock Unmount* containing a summary of the block execution (elapsed time, total rounds, etc.) for persistent storage.

## Block Types & Output Matrix

| Strategy                   | Block Type         | Reported Output                                                                          | Description                                                                                              |
| :------------------------- | :----------------- | :--------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------- |
| **SessionRootStrategy**    | `SessionRoot`      | `segment`<br>`completion`<br>`history:record`                                            | Top-level session container. Reports the entire session as a segment and records final history.          |
| **WorkoutRootStrategy**    | `Root` / `Workout` | `history:record`                                                                         | Legacy root strategy. Records history but does not currently emit segments.                              |
| **GenericTimerStrategy**   | `Timer`            | `segment`<br>`completion` (w/ duration)                                                  | Standard timer blocks (For Time, Countdown). Reports start/end and total duration.                       |
| **GenericLoopStrategy**    | `Rounds`           | `segment`<br>`completion`<br>`milestone` (Round Count)<br>`history:record`               | Round-based blocks (X Rounds). Reports start/end, updates on each round completion, and records history. |
| **AmrapLogicStrategy**     | `AMRAP`            | `segment`<br>`completion` (w/ duration)<br>`milestone` (Round Count)<br>`history:record` | As Many Rounds As Possible. Reports segment, duration, round splits, and history.                        |
| **IntervalLogicStrategy**  | `EMOM`             | `segment`<br>`completion` (w/ duration)<br>`milestone` (Round Count)<br>`history:record` | Every Minute On the Minute. Reports segment, duration, interval completion splits, and history.          |
| **GenericGroupStrategy**   | `Group`            | `history:record`                                                                         | Logic grouping without timer constraints. Records history but does not emit timeline segments.           |
| **RestBlockStrategy**      | `Rest`             | `segment`<br>`completion`                                                                | Auto-generated or explicit rest periods. Reports as a segment in the timeline.                           |
| **WaitingToStartStrategy** | `WaitingToStart`   | `segment`<br>`completion`                                                                | Pre-workout idle gate. Emits "Ready to Start" segment.                                                   |
| **IdleBlockStrategy**      | `Idle`             | *None*                                                                                   | Generic idle blocks used for transitions. Typically internal and do not report to output stream.         |

## Detailed Breakdown by Strategy

### SessionRootStrategy (`SessionRootBlock`)
*   **Block Type:** `SessionRoot`
*   **Behaviors:** `SegmentOutputBehavior`, `HistoryRecordBehavior`
*   **Lifecycle Reports:**
    *   **Mount:** Emits `segment` event with session label (e.g., "Morning WOD").
    *   **Unmount:** Emits `completion` event with duration and `history:record` event with summary.

### GenericTimerStrategy
*   **Block Type:** `Timer`
*   **Behaviors:** `SegmentOutputBehavior`, `TimerOutputBehavior`
*   **Lifecycle Reports:**
    *   **Mount:** Emits `segment` event.
    *   **Unmount:** Emits `completion` event. `TimerOutputBehavior` appends a `duration` fragment to this event.

### GenericLoopStrategy
*   **Block Type:** `Rounds`
*   **Behaviors:** `SegmentOutputBehavior`, `RoundOutputBehavior`, `HistoryRecordBehavior`
*   **Lifecycle Reports:**
    *   **Mount:** Emits `segment` event.
    *   **Next (Round Advance):** `RoundOutputBehavior` emits `milestone` event with current round count.
    *   **Unmount:** Emits `completion` event and `history:record` event.

### AmrapLogicStrategy & IntervalLogicStrategy (EMOM)
*   **Block Type:** `AMRAP` / `EMOM`
*   **Behaviors:** `SegmentOutputBehavior`, `TimerOutputBehavior`, `RoundOutputBehavior`, `HistoryRecordBehavior`
*   **Lifecycle Reports:**
    *   **Mount:** Emits `segment` event.
    *   **Next (Interval/Round):** Emits `milestone` event for round/interval completion.
    *   **Unmount:** Emits `completion` event (with duration from TimerOutput) and `history:record` event.

### GenericGroupStrategy
*   **Block Type:** `Group`
*   **Behaviors:** `HistoryRecordBehavior`
*   **Lifecycle Reports:**
    *   **Unmount:** Emits `history:record`.
    *   *Note:* Does not emit `segment`, so it will not appear as a distinct bar in the timeline visualization.

### RestBlockStrategy (`RestBlock`)
*   **Block Type:** `Rest`
*   **Behaviors:** `SegmentOutputBehavior`
*   **Lifecycle Reports:**
    *   **Mount:** Emits `segment` event (Label: "Rest").
    *   **Unmount:** Emits `completion` event.

### WaitingToStartStrategy (`WaitingToStartBlock`)
*   **Block Type:** `WaitingToStart`
*   **Behaviors:** `SegmentOutputBehavior`
*   **Lifecycle Reports:**
    *   **Mount:** Emits `segment` event (Label: "Ready to Start").
    *   **Unmount:** Emits `completion` event.
